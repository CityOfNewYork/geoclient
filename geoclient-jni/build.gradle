//plugins {
//  id 'jvm-component'
//  id 'java-lang'
//}
//
//model {
//  components {
//    main(JvmLibrarySpec) {
//      sources {
//        java {
//          dependencies {
//            library "generated"
//          }
//        }
//      }
//    }
//
//    generated(JvmLibrarySpec) {
//      sources {
//        generated(JavaSourceSet) {
//          //generatedBy tasks.generateJni
//          builtBy tasks.generateJni
//          dependencies {
//            configurations.jniRuntime
//          }
//        }
//      }
//    }
//  }
//}
def generatedJavaSourceDir = "$projectDir/src/generated/java"

sourceSets {
  generated {
    output.dir(generatedJavaSourceDir, builtBy: 'generateJavaSource')
  }
}
task generateJavaSource(type: Sync) {
  from project(':geoclient-generate').generateJavaSource
  into generatedJavaSourceDir
}

dependencies {
  generatedCompile(configurations.jniRuntime)
  compile configurations.generatedCompile
}

compileGeneratedJava {
  dependsOn(generateJavaSource)
}

compileJava {
  dependsOn(compileGeneratedJava)
  classpath = files(classpath, sourceSets.generated.output.classesDir)
}

// Previously, With hard-coded dependency on code generation task
// task runJni (type: JavaExec, dependsOn: ['compileJava',':geoclient-native:assemble']) {
//task runJni (type: JavaExec, dependsOn: 'compileJava') {
//  classpath = sourceSets.main.runtimeClasspath + sourceSets.generated.runtimeClasspath
//  main = 'gov.nyc.doitt.gis.geoclient.jni.test.JniTest'
//  executable = "${jniJavaHome}/bin/java"
//  systemProperties('java.library.path', gsLibraryPath)
//  environment('GEOFILES', gsGeofiles)
//}
//
//test.dependsOn(runJni)

jar {
  from sourceSets.main.output
  from sourceSets.generated.output.classesDir
}

artifacts {
  archives jar
}

